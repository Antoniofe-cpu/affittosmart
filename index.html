<!DOCTYPE html>
<html lang="it">
<head>
    <script src="https://www.google.com/recaptcha/api.js?render=6LdxHoUrAAAAAArmVqB1L4sHpph6RjNX5n6TnmFm"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trova la Tua Casa a Bologna - Affitto Smart</title>
    
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="shortcut icon" href="favicon.ico">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   <style>
    :root { 
        --colore-primario: #0D47A1; 
        --colore-secondario: #1565C0; 
        --colore-accento: #FFA000; 
        --colore-testo: #212121; 
        --colore-testo-chiaro: #616161; 
        --colore-sfondo-pagina: #f4f6f9; 
        --colore-bianco: #ffffff;
        --colore-errore: #D32F2F;
    }
    html { scroll-behavior: smooth; }
    body { font-family: 'Poppins', sans-serif; margin: 0; background-color: var(--colore-bianco); }
    .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }
    
    /* SEZIONI E TITOLI */
    .section { padding: 100px 0; }
    .section-light { background-color: var(--colore-sfondo-pagina); }
    .section-dark { background-color: var(--colore-primario); color: var(--colore-bianco); }
    .section-title { font-size: 3em; font-weight: 800; color: var(--colore-primario); margin-bottom: 20px; text-align: center; }
    .section-subtitle { font-size: 1.3em; color: var(--colore-testo-chiaro); max-width: 700px; margin: 0 auto 60px auto; text-align: center; }
    
    /* HEADER */
    .header {
    display: flex;
    justify-content: center; /* Forza il contenuto principale (il logo) a centrarsi */
    align-items: center;
    padding: 20px 40px;
    border-bottom: 1px solid #eee;
    position: relative; /* Necessario per il posizionamento assoluto del figlio */
}

.logo {
    font-size: 2.2em;
    font-weight: 800;
    color: var(--colore-primario);
    text-decoration: none;
    /* Rimuovi margin-right: auto; non serve più */
}
.logo span { 
    font-weight: 400; 
    color: var(--colore-secondario); 
}

.header-actions {
    position: absolute; /* Strappa il pulsante dal flusso normale */
    right: 40px; /* Lo posiziona a 40px dal bordo destro */
    top: 50%; /* Lo posiziona a metà altezza */
    transform: translateY(-50%); /* Lo centra verticalmente in modo perfetto */
}
    .login-link { 
        display: inline-flex; 
        align-items: center; 
        gap: 10px; 
        font-weight: 600; 
        color: var(--colore-primario); 
        background-color: #e3f2fd; 
        padding: 10px 20px; 
        border-radius: 50px; 
        text-decoration: none; 
        border: 1px solid transparent; 
        transition: all 0.3s ease; 
        cursor: pointer; 
    }
    .login-link:hover { 
        background-color: var(--colore-bianco); 
        border-color: var(--colore-primario); 
        transform: translateY(-2px); 
        box-shadow: 0 4px 12px rgba(13, 71, 161, 0.1); 
    }
    .login-link .fa-solid { font-size: 1.2em; }

    /* HERO & FORM DI RICERCA */
    .hero-search-wrapper { position: relative; padding: 80px 0; color: var(--colore-bianco); text-align: center; }
    .hero-search-wrapper::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-image: linear-gradient(rgba(13, 71, 161, 0.8), rgba(25, 118, 210, 0.85)), url('https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=1200'); background-size: cover; background-position: center; z-index: 1; }
    .hero-search-content { position: relative; z-index: 2; }
    .hero-search-content h1 { color: var(--colore-bianco); font-size: 3.5em; text-shadow: 0 2px 5px rgba(0,0,0,0.3); }
    .hero-search-content .subtitle { color: rgba(255,255,255,0.9); font-size: 1.4em; max-width: 700px; margin: 15px auto 50px auto; }
    .unified-form { background: var(--colore-bianco); color: var(--colore-testo); padding: 40px; border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.2); text-align: left; }
    .form-section { margin-bottom: 30px; padding-bottom: 30px; }
    .form-section:last-of-type { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
    .form-section h2 { font-size: 1.8em; margin-top: 0; display: flex; align-items: center; gap: 15px; border-bottom: 2px solid #e0e0e0; padding-bottom: 15px; margin-bottom: 30px;}
    .form-section .icon { color: var(--colore-accento); }
    .filter-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 25px 30px; }
    .filter-group { text-align: left; }
    .filter-group label { font-weight: 600; display: block; margin-bottom: 10px; }
    .filter-group select, .filter-group input { width: 100%; padding: 14px; border-radius: 8px; border: 1px solid #ccc; font-size: 1em; box-sizing: border-box; background-color: white; font-family: 'Poppins', sans-serif; }
    .pill-options { display: flex; gap: 10px; height: 51px; }
    .pill-options input { display: none; }
    .pill-options label { flex: 1; display: flex; justify-content: center; align-items: center; text-align: center; padding: 12px; border: 1px solid #ccc; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; font-weight: 600; background-color: white; }
    .pill-options input:checked + label { background-color: var(--colore-primario); color: white; border-color: var(--colore-primario); }
    #profile-section { max-height: 0; overflow: hidden; opacity: 0; transition: all 0.6s ease-in-out; border-top: none; }
    #profile-section.visible { max-height: 1000px; opacity: 1; border-top: 2px dashed #d0d0d0; margin-top: 30px; padding-top: 30px; }
    #search-button { width: 100%; height: 60px; border-radius: 12px; border: none; margin-top: 40px; background-image: linear-gradient(45deg, var(--colore-accento), #FF8F00); color: var(--colore-testo); font-size: 1.4em; font-weight: 700; cursor: pointer; }
    #search-button .fa-solid { margin-left: 10px; }
    .filter-group .input-error, .modal-content .form-group input.input-error { border-color: var(--colore-errore); }
    .error-message { color: var(--colore-errore); font-size: 0.85em; margin-top: 5px; height: 1.2em; visibility: hidden; }
    .error-message.visible { visibility: visible; }

    /* SEZIONE PROCESSO (WHY US) */
    .process-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 25px; margin-top: 60px; }
    .process-step { text-align: center; padding: 30px; background: white; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.07); border-bottom: 5px solid var(--colore-accento); transition: transform 0.3s ease; }
    .process-step:hover { transform: translateY(-10px); }
    .process-step .icon { font-size: 3.5em; color: var(--colore-primario); margin-bottom: 20px; line-height: 1; }
    .process-step h3 { font-size: 1.4em; color: var(--colore-primario); }

    /* SEZIONE VISUAL */
    .visual-process { display: grid; grid-template-columns: 1fr 1fr; gap: 50px; align-items: center; }
    .visual-process img { width: 100%; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
    .visual-process h3 { font-size: 2em; }
    
    /* SEZIONE FAQ */
    #faq .section-title { color: var(--colore-bianco); }
    #faq .section-subtitle { color: rgba(255,255,255,0.8); }
    .faq-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 1100px; margin: 0 auto; align-items: start; }
    .faq-item { border-radius: 12px; background: rgba(255,255,255,0.1); overflow: hidden; }
    .faq-question { width: 100%; background: transparent; border: none; padding: 20px; font-size: 1.1em; font-weight: 600; text-align: left; cursor: pointer; display: flex; justify-content: space-between; align-items: center; color: var(--colore-bianco); }
    .faq-answer { color: rgba(255,255,255,0.9); padding: 0 20px; max-height: 0; overflow: hidden; transition: max-height 0.4s ease, padding 0.4s ease; }
    .faq-item.active .faq-answer { max-height: 200px; padding: 0 20px 20px 20px; }

    /* FOOTER */
    .main-footer { background-color: #1c2833; color: #bdc3c7; padding: 50px 0; text-align: center; }
    .main-footer .logo-container { margin-bottom: 20px; }
    .main-footer .logo-main { font-size: 1.8em; font-weight: 800; color: var(--colore-bianco); }
    .main-footer .logo-main span { font-weight: 400; color: #76aae9; }
    .main-footer .logo-tagline { font-size: 0.9em; color: #bdc3c7; letter-spacing: 0.5px; margin-top: 2px; font-weight: 600; }
    .main-footer .contatti-completi p { margin: 20px 0; font-size: 1em; color: #A0A0A0; }
    .main-footer .legal-links { margin: 20px 0; font-size: 1em; }
    .main-footer .legal-links a { color: var(--colore-bianco); text-decoration: none; transition: color 0.3s ease; font-weight: 600; padding: 0 15px; }
    .main-footer .legal-links a:hover { color: var(--colore-accento); }
    .main-footer .copyright { margin-top: 10px; font-size: 0.9em; opacity: 0.7; }
    
    /* SEZIONE GARANZIA */
    .guarantee-section { padding: 100px 0; background-color: var(--colore-bianco); }
    .guarantee-content { display: grid; grid-template-columns: 1fr 1.5fr; gap: 50px; align-items: center; }
    .guarantee-image { width: 100%; height: 300px; border-radius: 16px; overflow: hidden; box-shadow: 0 15px 40px rgba(0,0,0,0.1); }
    .guarantee-image img { width: 100%; height: 100%; object-fit: cover; object-position: center 25%; }
    .guarantee-text h2 { font-size: 2.5em; text-align: left; margin-bottom: 20px; }
    .guarantee-text p { font-size: 1.1em; color: var(--colore-testo-chiaro); line-height: 1.8; margin-bottom: 20px; }
    .guarantee-points .point { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; font-weight: 600; }
    .guarantee-points .icon { font-size: 1.5em; color: #2E7D32; }

    /* STILI MODAL */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(13, 71, 161, 0.8); backdrop-filter: blur(8px); display: flex; justify-content: center; align-items: center; z-index: 5000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0s 0.3s; }
    .modal-overlay.visible { opacity: 1; visibility: visible; transition: opacity 0.3s ease; }
    .modal-content { background: white; padding: 40px; border-radius: 16px; width: 100%; max-width: 480px; text-align: center; position: relative; transform: scale(0.95); transition: transform 0.3s ease; }
    .modal-overlay.visible .modal-content { transform: scale(1); }
    .modal-content h1 { font-size: 2.2em; color: var(--colore-primario); margin: 0 0 10px 0; }
    .modal-content p { color: var(--colore-testo-chiaro); margin-bottom: 30px; line-height: 1.6; }
    .close-modal-button { position: absolute; top: 15px; right: 15px; background: transparent; border: none; font-size: 2em; line-height: 1; cursor: pointer; color: #aaa; }
    .modal-content .form-group { text-align: left; margin-bottom: 20px; }
    .modal-content .form-group label { font-weight: 600; display: block; margin-bottom: 8px; color: var(--colore-primario); }
    .modal-content .form-group input { width: 100%; padding: 14px; border-radius: 8px; border: 1px solid #ccc; font-size: 1em; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    .modal-content .login-button { width: 100%; padding: 15px; border: none; border-radius: 8px; background-color: var(--colore-primario); color: white; font-size: 1.1em; font-weight: 700; cursor: pointer; margin-top: 10px; transition: background-color 0.2s; }
    .modal-content .login-button:disabled { background-color: #999; cursor: not-allowed; }
    .modal-content .form-message { margin-top: 20px; padding: 15px; border-radius: 8px; font-weight: 600; display: none; }
    .modal-content .form-message.success { display: block; background-color: #e0f2f1; color: #00796b; }
    .modal-content .form-message.error { display: block; background-color: #ffebee; color: #c0392b; }

    /* MEDIA QUERIES */
    @media (max-width: 1100px) { .process-grid { grid-template-columns: repeat(2, 1fr); } .faq-grid { grid-template-columns: 1fr; } }
    @media (max-width: 900px) { .filter-grid { grid-template-columns: 1fr 1fr; } }
    @media (max-width: 768px) { .guarantee-content, .visual-process { grid-template-columns: 1fr; } }
    @media (max-width: 600px) { .process-grid, .filter-grid { grid-template-columns: 1fr; } .header { flex-direction: column; gap: 20px; } }
</style>
</head>
<body>
    <header class="header">
        <a href="index.html" class="logo">Affitto <span>Smart</span></a>
        <div class="header-actions">
            <a href="#" id="open-login-modal" class="login-link">
    <i class="fa-solid fa-user-circle"></i>
</a>
        </div>
    </header>

    <main>
        <form id="unified-search-form">
            <section class="hero-search-wrapper">
                <div class="hero-search-content container">
                    <h1>La casa giusta, senza compromessi.</h1>
                    <p class="subtitle">Dicci chi sei e cosa cerchi. <br>Il nostro sistema intelligente ti mostrerà solo le opportunità a Bologna per cui sei perfettamente compatibile.</p>
                    
                    <div class="unified-form">
                        <div class="form-section" id="preferences-section">
                            <h2><i class="fa-solid fa-map-location-dot icon"></i>Cosa cerchi?</h2>
                            <div class="filter-grid">
                                <div class="filter-group"><label>Tipo di Immobile</label><select name="tipo"><option value="">Qualsiasi</option><option>Stanza Singola</option><option>Monolocale</option><option>Bilocale</option></select></div>
                                <div class="filter-group"><label>Zona</label><select name="zona"><option value="">Qualsiasi</option><option>Centro Storico</option><option>Murri</option><option>Bolognina</option><option>Saragozza</option><option>Lame</option><option>San Donato</option></select></div>
                                <div class="filter-group"><label>Budget Max (€)</label><input type="number" name="prezzo" placeholder="Es. 900"></div>
                                <div class="filter-group"><label>Disponibile dal</label><input type="date" name="data_disponibile"></div>
                                <div class="filter-group"><label>Periodo di Affitto</label><select name="periodo_affitto"><option value="">Qualsiasi</option><option>Breve (meno di 6 mesi)</option><option>Standard (1-3 anni)</option><option>Lungo (più di 3 anni)</option></select></div>
                            </div>
                        </div>

                        <div class="form-section" id="profile-section">
                        <h2><i class="fa-solid fa-user-check icon"></i>Perfetto! Completa il tuo profilo.</h2>
                        <div class="filter-grid">
                            <div class="filter-group">
                                <label>Situazione Lavorativa</label>
                                <select name="situazione_lavorativa" id="situazione_lavorativa">
                                    <option value="" disabled selected>Seleziona...</option>
                                    <option>Dipendente a tempo indeterminato</option>
                                    <option>Studente/ssa con garante</option>
                                    <option>Lavoratore Autonomo / P.IVA</option>
                                </select>
                                <p class="error-message" id="error-lavoro">Campo obbligatorio</p>
                            </div>
                            <div class="filter-group">
                                <label>Reddito Netto Mensile</label>
                                <select name="reddito_utente" id="reddito_utente">
                                    <option value="" disabled selected>Seleziona fascia...</option>
                                    <option value="1500">Meno di 1.500 €</option>
                                    <option value="2000">1.501-2.000 €</option>
                                    <option value="2500">2.001-2.500 €</option>
                                    <option value="3000">Oltre 2.500 €</option>
                                </select>
                                <p class="error-message" id="error-reddito">Campo obbligatorio</p>
                            </div>
                            <div class="filter-group"><label>Stai cercando</label><div class="pill-options"><input type="radio" id="solo" name="tipo_ricerca" value="Da solo/a" checked><label for="solo">Da solo/a</label><input type="radio" id="coppia" name="tipo_ricerca" value="In coppia"><label for="coppia">In coppia</label></div></div>
                            <div class="filter-group"><label>Il tuo sesso</label><div class="pill-options"><input type="radio" id="sesso_m" name="sesso_utente" value="M" checked><label for="sesso_m">M</label><input type="radio" id="sesso_f" name="sesso_utente" value="F"><label for="sesso_f">F</label></div></div>
                            <div class="filter-group"><label>Fumatore?</label><div class="pill-options"><input type="radio" id="fumatore_no" name="fumatore" value="No" checked><label for="fumatore_no">No</label><input type="radio" id="fumatore_si" name="fumatore" value="Sì"><label for="fumatore_si">Sì</label></div></div>
                            <div class="filter-group"><label>Animali?</label><div class="pill-options"><input type="radio" id="animali_no" name="animali" value="No" checked><label for="animali_no">No</label><input type="radio" id="animali_si" name="animali" value="Sì"><label for="animali_si">Sì</label></div></div>
                        </div>
                    </div>
                    <button type="submit" id="search-button">Prosegui <i class="fa-solid fa-arrow-right"></i></button>
                </div>
            </section>
        </form>
              
    <section class="why-us section-light">
        <div class="container text-center">
            <h2 class="section-title">Il nostro non è un semplice annuncio.<br>È un invito a un evento esclusivo.</h2>
            <p class="section-subtitle">Capire il nostro metodo significa capire perché avrai più chance di trovare la casa che desideri, senza stress.</p>
            <div class="process-grid">
                <div class="process-step"> <div class="icon"><i class="fa-solid fa-users-slash"></i></div> <h3>Basta Caos, Solo Qualità</h3> <p>Sui portali gratuiti la tua candidatura è una goccia nell'oceano. Qui entri in un canale esclusivo dove competi solo con profili compatibili come il tuo.</p> </div>
                <div class="process-step" style="background-color: var(--colore-primario); color: white; border-color: var(--colore-accento);"> <div class="icon" style="color: var(--colore-accento);"><i class="fa-solid fa-crown"></i></div> <h3 style="color: white;">Il Canale Preferenziale</h3> <p style="color: rgba(255,255,255,0.9);">Mentre gli altri perdono tempo, tu investi in un accesso diretto. Noi facciamo il lavoro sporco, tu arrivi dritto all'opportunità.</p> </div>
                <div class="process-step"> <div class="icon"><i class="fa-solid fa-ticket-simple"></i></div> <h3>Il Pass per l'Esclusività</h3> <p>Il tuo pass da 2,99€ non è un costo, è la chiave. Garantisce Open Day a numero chiuso e, se non vieni scelto, è valido per altre 2 opportunità.</p> </div>
                <div class="process-step"> <div class="icon"><i class="fa-solid fa-handshake-simple"></i></div> <h3>L'Open Day Vincente</h3> <p>Un evento rilassato e professionale dove hai tutto il tempo per vedere la casa e fare la differenza. La tua migliore occasione per essere scelto.</p> </div>
            </div>
        </div>
    </section>

    <section class="guarantee-section">
        <div class="container">
            <div class="guarantee-content">
                <div class="guarantee-image"> <img src="https://images.pexels.com/photos/3184431/pexels-photo-3184431.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="Il nostro team verifica ogni immobile"> </div>
                <div class="guarantee-text">
                    <h2>Annunci Verificati, Opportunità Reali.</h2>
                    <p>Sappiamo quanto sia frustrante il mercato degli affitti. <br>Annunci che spariscono, foto ingannevoli, appuntamenti a vuoto.<br>Noi abbiamo eliminato tutto questo.<br>Il nostro impegno è la tua tranquillità.</p>
                    <div class="guarantee-points">
                        <div class="point"> <i class="fa-solid fa-house-circle-check icon"></i> <span>Ogni immobile è verificato di persona dal nostro team.</span> </div>
                        <div class="point"> <i class="fa-solid fa-calendar-check icon"></i> <span>Gli Open Day sono eventi reali e confermati.</span> </div>
                        <div class="point"> <i class="fa-solid fa-shield-halved icon"></i> <span>La piccola fee è la tua assicurazione contro i perditempo.</span> </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <section class="section-white">
        <div class="container">
            <div class="visual-process">
                <div>
                    <h3>Il Controllo è nelle Tue Mani.</h3>
                    <p class="section-subtitle" style="text-align: left; margin: 20px 0; max-width: 100%;">Dopo aver acquistato il tuo ticket, il passo finale è semplice. Verrai reindirizzato alla nostra agenda privata dove potrai scegliere, con un solo click, lo slot orario che preferisci per l'Open Day. <br>Niente telefonate, niente attese. <br>Solo tu, il tuo calendario e la tua prossima casa.</p>
                </div>
                <div> <img src="assets/calendly-esempio.png" alt="Esempio di prenotazione orario su Calendly"> </div>
            </div>
        </div>
    </section>
        
    <section id="faq" class="section-dark">
        <div class="container">
            <h2 class="section-title text-center">Hai Ancora Dubbi? È Normale!</h2>
            <p class="section-subtitle text-center">La nostra trasparenza è la tua prima garanzia.</p>
            <div class="faq-grid">
                <div class="faq-item"> <button class="faq-question"><span>Perché devo pagare 2,99€?</span><i class="fa-solid fa-chevron-down"></i></button> <div class="faq-answer"><p>La piccola fee è un filtro di serietà. Ci permette di garantire che solo persone realmente interessate partecipino, creando un'esperienza di visita di alta qualità per tutti. È il tuo modo per dire "Io ci sono e faccio sul serio".</p></div> </div>
                <div class="faq-item"> <button class="faq-question"><span>Cosa succede al mio pass se non vengo scelto?</span><i class="fa-solid fa-chevron-down"></i></button> <div class="faq-answer"><p>Questa è la parte migliore. Il tuo pass non è legato a un singolo immobile. Se non vieni scelto, resta valido per accedere ai prossimi 3 Open Day per cui risulterai compatibile. È la nostra garanzia per non farti mai sprecare un'opportunità.</p></div> </div>
                <div class="faq-item"> <button class="faq-question"><span>Se pago, ho più chance di ottenere la casa?</span><i class="fa-solid fa-chevron-down"></i></button> <div class="faq-answer"><p>Pagare ti dà l'accesso esclusivo all'Open Day, un vantaggio enorme. Non garantisce l'assegnazione, ma ti mette in una posizione privilegiata per fare un'ottima impressione sul proprietario, che farà la sua scelta finale.</p></div> </div>
                <div class="faq-item"> <button class="faq-question"><span>Cosa succede dopo l'Open Day?</span><i class="fa-solid fa-chevron-down"></i></button> <div class="faq-answer"><p>Dopo la visita, potrai formalizzare il tuo interesse. Raccoglieremo le proposte e le presenteremo al proprietario. Ti garantiamo un feedback rapido, qualunque sia l'esito.</p></div> </div>
                <div class="faq-item"> <button class="faq-question"><span>Chi si occupa del contratto d'affitto?</span><i class="fa-solid fa-chevron-down"></i></button> <div class="faq-answer"><p>Una volta che il proprietario ha scelto e tu hai accettato, vi metteremo in contatto diretto per finalizzare l'accordo. Possiamo fornirvi modelli di contratto standard e consigliarvi professionisti per la stesura e la registrazione.</p></div> </div>
                <div class="faq-item"> <button class="faq-question"><span>E per la consegna delle chiavi?</span><i class="fa-solid fa-chevron-down"></i></button> <div class="faq-answer"><p>La consegna delle chiavi avviene direttamente tra te e il proprietario al momento della firma del contratto o nella data di inizio locazione concordata. Il nostro ruolo termina con il matching perfetto.</p></div> </div>
            </div>
        </div>
    </section>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="logo-container">
                <div class="logo-main">Affitto <span>Smart</span></div>
                <div class="logo-tagline">La tua ricerca intelligente, la nostra garanzia.</div>
            </div>
            <div class="contatti-completi">
                <p><a href="tel:+393330000000">[Il Vostro Numero]</a> | <a href="mailto:bologna@affitto-smart.it">bologna@affitto-smart.it</a></p>
            </div>
            <div class="legal-links">
                <a href="recupera-accesso.html">Accedi / Gestisci Ticket</a>
                <a href="proprietario.html">Sei un Proprietario?</a>
                <a href="#">Privacy Policy</a>
            </div>
            <p class="copyright">© 2025 Affitto Smart. Tutti i diritti riservati.</p>
        </div>
    </footer>

    <!-- === BLOCCO HTML DEI MODAL DA AGGIUNGERE === -->

<!-- MODAL 1: Per il Login / Accesso Diretto -->
<div class="modal-overlay" id="login-modal">
    <div class="modal-content">
        <button class="close-modal-button" aria-label="Chiudi modal">×</button>
        <h1>Accedi alla Tua Area</h1>
        <p>Inserisci la tua email per vedere le tue prenotazioni.</p>
        <form id="login-modal-form" novalidate>
            <div class="form-group">
                <label for="login-email">Indirizzo Email</label>
                <input type="email" id="login-email" required>
                <p class="error-message" id="login-error-email"></p>
            </div>
            <button type="submit" id="login-modal-button" class="login-button">Inviami il Link di Accesso</button>
        </form>
        <div class="form-message" id="login-form-message"></div>
    </div>
</div>

<!-- MODAL 2: Per completare la Ricerca -->
<div class="modal-overlay" id="search-modal">
    <div class="modal-content">
        <button class="close-modal-button" aria-label="Chiudi modal">×</button>
        <h1>Un Ultimo Passo...</h1>
        <p>Inserisci la tua email per vedere gli annunci compatibili. Se sei già nostro cliente, ti riconosceremo!</p>
        <form id="search-modal-form" novalidate>
            <div class="form-group">
                <label for="search-user-email">Il tuo indirizzo email</label>
                <input type="email" id="search-user-email" required placeholder="mario.rossi@email.com">
                <p class="error-message" id="search-error-email"></p>
            </div>
            <button type="submit" id="search-modal-button" class="login-button">Vedi i Risultati</button>
        </form>
    </div>
</div>

     <script>
    document.addEventListener('DOMContentLoaded', function() {
        // === CONFIGURAZIONE ===
        const CANDIDATES_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRkbpjTqQmyIW-qPDT-iLpE6duimrufjvzM3AXd_ng8D2rXW0tTWz3KMmZ1oE8nUCDx0CkUtePZZr_N/pub?gid=871257678&single=true&output=csv';
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzQvkfR_I6r2b58FWi34vsmOUebIKogRKwQ-E8J4mpOLIYGRi0LnZYtOZUKNKprIR8E/exec';
        
         // === RIFERIMENTI AGLI ELEMENTI DEL DOM ===
        const mainSearchForm = document.getElementById('unified-search-form');
        const searchButton = document.getElementById('search-button');
        const profileSection = document.getElementById('profile-section');
        const openLoginModalButton = document.getElementById('open-login-modal');
        
        const loginModal = document.getElementById('login-modal');
        const searchModal = document.getElementById('search-modal');
        
        const loginModalForm = document.getElementById('login-modal-form');
        const searchModalForm = document.getElementById('search-modal-form');

        let formPhase = 1;

        // === FUNZIONI HELPER ===
        function csvToObjects(csv) {
            if (!csv) return [];
            const lines = csv.trim().split(/\r\n|\n/);
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            return lines.slice(1).map(line => {
                if (!line) return null;
                const values = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return headers.reduce((obj, header, i) => {
                    obj[header] = values[i] ? values[i].replace(/"/g, '').trim() : '';
                    return obj;
                }, {});
            }).filter(Boolean);
        }

        function openModal(modal) { if (modal) modal.classList.add('visible'); }
        function closeModal(modal) { if (modal) modal.classList.remove('visible'); }

        function validateEmail(inputElement, errorElement) {
            if (!inputElement || !errorElement) return null;
            const email = inputElement.value.trim();
            errorElement.classList.remove('visible');
            inputElement.classList.remove('input-error');
            if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                errorElement.textContent = "Per favore, inserisci un'email valida.";
                errorElement.classList.add('visible');
                inputElement.classList.add('input-error');
                return null;
            }
            return email;
        }

        // === GESTIONE APERTURA/CHIUSURA DEI MODAL ===
        if (openLoginModalButton) {
            openLoginModalButton.addEventListener('click', (e) => {
                e.preventDefault();
                openModal(loginModal);
            });
        }
        [loginModal, searchModal].forEach(modal => {
            if (modal) {
                modal.querySelector('.close-modal-button').addEventListener('click', () => closeModal(modal));
                modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(modal); });
            }
        });
        
        // === LOGICA DEL WIZARD DEL FORM DI RICERCA PRINCIPALE ===
        if (searchButton) {
            searchButton.addEventListener('click', function(e) {
                e.preventDefault();
                if (formPhase === 1) {
                    profileSection.classList.add('visible');
                    formPhase = 2;
                    searchButton.innerHTML = 'Scopri Le Tue Opportunità <i class="fa-solid fa-arrow-right"></i>';
                    profileSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else if (formPhase === 2) {
                    const lavoroSelect = document.getElementById('situazione_lavorativa');
                    const redditoSelect = document.getElementById('reddito_utente');
                    const errorLavoro = document.getElementById('error-lavoro');
                    const errorReddito = document.getElementById('error-reddito');
                    let isProfileValid = true;
                    
                    if(lavoroSelect) lavoroSelect.classList.remove('input-error');
                    if(errorLavoro) errorLavoro.classList.remove('visible');
                    if(redditoSelect) redditoSelect.classList.remove('input-error');
                    if(errorReddito) errorReddito.classList.remove('visible');

                    if (!lavoroSelect || !lavoroSelect.value) { isProfileValid = false; if(lavoroSelect) lavoroSelect.classList.add('input-error'); if(errorLavoro) errorLavoro.classList.add('visible'); }
                    if (!redditoSelect || !redditoSelect.value) { isProfileValid = false; if(redditoSelect) redditoSelect.classList.add('input-error'); if(errorReddito) errorReddito.classList.add('visible'); }
                    
                    if (isProfileValid) {
                        openModal(searchModal);
                    } else if (lavoroSelect) {
                        lavoroSelect.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            });
        }

        // === LOGICA DEL MODAL DI ACCESSO DIRETTO ("LA MIA AREA") ===
        if (loginModalForm) {
            loginModalForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const emailInput = document.getElementById('login-email');
                const errorDiv = document.getElementById('login-error-email');
                const formMessageDiv = document.getElementById('login-form-message'); // Assicurati che questo esista nell'HTML

                // === CHIAMATA CORRETTA ALLA FUNZIONE validateEmail ===
                const email = validateEmail(emailInput, errorDiv);
                if (!email) return;

                const button = e.target.querySelector('button');
                button.disabled = true;
                button.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Invio in corso...';
                
                const urlWithParams = `${WEB_APP_URL}?action=sendMagicLink&email=${encodeURIComponent(email)}`;
                try {
                    const response = await fetch(urlWithParams);
                    const result = await response.json();
                    
                    if (result.result === 'success' && result.message === "Email inviata.") {
                        loginModalForm.style.display = 'none';
                        if (formMessageDiv) {
                            formMessageDiv.textContent = 'Fatto! Se l\'email è registrata, riceverai a breve un link. Controlla anche la cartella spam.';
                            formMessageDiv.className = 'form-message success';
                        } else { // Fallback se il div del messaggio non c'è
                             alert('Fatto! Se l\'email è registrata, riceverai a breve un link.');
                        }
                    } else {
                        errorDiv.textContent = "Nessun account trovato. Effettua una ricerca e acquista un ticket per registrarti.";
                        errorDiv.classList.add('visible');
                    }
                } catch (error) {
                    alert("Errore di connessione. Riprova più tardi.");
                } finally {
                    button.disabled = false;
                    button.innerHTML = 'Inviami il Link di Accesso';
                }
            });
        }
        
        // === LOGICA DEL MODAL DI RICERCA (DOPO IL WIZARD) ===
        if (searchModalForm) {
            searchModalForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const emailInput = document.getElementById('search-user-email');
                const errorDiv = document.getElementById('search-error-email');
                const email = validateEmail(emailInput, errorDiv);
                if (!email) return;

                const button = e.target.querySelector('button');
                button.disabled = true;
                button.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';

                try {
                    const response = await fetch(CANDIDATES_URL);
                    const candidates = csvToObjects(await response.text());
                    const existingUser = candidates.find(c => c.Email && c.Email.toLowerCase() === email.toLowerCase());

                    const mainFormData = new FormData(mainSearchForm);
                    mainFormData.append('user_email', email);
                    const queryString = new URLSearchParams(mainFormData).toString();
                    let finalUrl = `risultati.html?${queryString}`;

                    if (existingUser && existingUser.Token) {
                        finalUrl += `&token=${existingUser.Token}`;
                    }
                    
                    window.location.href = finalUrl;
                } catch (error) {
                    alert("Errore di connessione. Riprova.");
                    button.disabled = false;
                    button.innerHTML = 'Vedi i Risultati';
                }
            });
        }

        // === LOGICA FAQ ===
        document.querySelectorAll('.faq-question').forEach(button => {
            const faqItem = button.parentElement;
            button.addEventListener('click', () => {
                const wasActive = faqItem.classList.contains('active');
                document.querySelectorAll('.faq-item').forEach(item => item.classList.remove('active'));
                if (!wasActive) faqItem.classList.add('active');
            });
        });
    });
</script>
</body>
</html>
